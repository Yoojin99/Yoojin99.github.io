---  
layout: post  
title: "[iOS] - Push ì•Œë¦¼, Notification ì‹œë®¬ë ˆì´í„°ì—ì„œ ë„ìš°ê¸°"  
subtitle: ""  
categories: app
tags: app-ios 
comments: true  
header-img: img/dev/app/ios/XcodeImg.png

---  
  
> `iOSì—ì„œ push ì•Œë¦¼ì„ ë„ìš°ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì.`  

---

![image](https://user-images.githubusercontent.com/41438361/120766969-b7b64580-c555-11eb-8b0a-90c4e4e0cf6b.png)

ìœ„ì™€ ê°™ì€ ì•Œë¦¼ì„ ë„ì›Œë³´ì. Xcodeë¥¼ simulatorë¡œ ì‹¤í–‰ì‹œí‚¬ ë•Œ device tokenì´ ë°œí–‰ì´ ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— push ì•Œë¦¼ì„ simulatorì— ë„ìš¸ ìˆ˜ ì—†ì„ ê²ƒì²˜ëŸ¼ ë³´ì´ì§€ë§Œ í…ŒìŠ¤íŠ¸ í•˜ëŠ” ë°©ë²•ì´ ìˆì—ˆë‹¤ğŸ‰

ë¨¼ì € push ì•Œë¦¼ì„ ë„ìš°ëŠ”ë° ê°€ì¥ ì¤‘ìš”í•œ ê²ƒì€ ì•„ë˜ 3ê°€ì§€ì´ë©°, ë‹¤ êµ‰ì¥íˆ ê°„ë‹¨í•˜ë¯€ë¡œ ì‰½ê²Œ push ì•Œë¦¼ì„ í…ŒìŠ¤íŠ¸ í•  ìˆ˜ ìˆë‹¤.

1. ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ì„ ë„ìš¸ ê¶Œí•œ ìš”ì²­í•˜ê¸°
2. apns íŒŒì¼ ìƒì„±í•˜ê¸°
3. UNUserNotificationCenterDelegate êµ¬í˜„í•´ì„œ ì•Œë¦¼ì— ëŒ€í•œ ë™ì‘ ì²˜ë¦¬í•˜ê¸° (ìƒëµí•´ë„ ë˜ê¸´ í•˜ë‹¤.)

ë¨¼ì € Simulatorì—ì„œë„ Push ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ Xcode 11.4ë²„ì „ ì´ìƒì´ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤. ë§Œì•½ Xcode ë²„ì „ì´ 11.4 ì´ìƒì´ë©´ ì•„ë˜ì˜ ê³¼ì •ë“¤ì„ ë”°ë¼í•´ë³´ì.

## 1. ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ì„ ë„ìš¸ ê¶Œí•œ ìš”ì²­í•˜ê¸°

iOS ë°°í¬ ë²„ì „ì´ 13 ì´ìƒì´ë©´ AppDelegateì— ì¶”ê°€ë¡œ SceneDelegateê°€ Xcode í”„ë¡œì íŠ¸ì— ì¶”ê°€ê°€ ë˜ì–´ ìˆëŠ” ìƒíƒœì¼í…ë°, ë‚˜ëŠ” AppDelegateì— push ì•Œë¦¼ê³¼ ê´€ë ¨ëœ ì½”ë“œë¥¼ ì‘ì„±í–ˆë‹¤.

`AppDelegate.swift`ì—ì„œ ì•±ì´ ì‹¤í–‰ë˜ë©´ í˜¸ì¶œë˜ëŠ” `func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool` í•¨ìˆ˜ ì•ˆì— ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•œë‹¤.

```swift
func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
    // Override point for customization after application launch.
    let center = UNUserNotificationCenter.current()
    center.requestAuthorization(options: [.alert, .sound, .badge]) { granted, error in // ì•Œë¦¼ì„ ë„ìš¸ ë•Œ alert, sound, badgeë¥¼ ë„ìš¸ ê¶Œí•œì„ ì‚¬ìš©ìì—ê²Œ ìš”ì²­í•œë‹¤.
        print("Permission granted : \(granted)") // ë§Œì•½ ì‚¬ìš©ìê°€ ê¶Œí•œì„ í—ˆìš©í–ˆë‹¤ë©´ grantedëŠ” trueë¡œ, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ falseë¡œ ì¶œë ¥ëœë‹¤.
    }

    UIApplication.shared.registerForRemoteNotifications()
    return true
}
```

ì´ ìƒíƒœì—ì„œ ì•±ì„ ì‹¤í–‰ì‹œí‚¤ë©´ ì•„ë˜ì™€ ê°™ì´ ì•± ê¶Œí•œì„ ìš”ì²­í•˜ëŠ” íŒì—…ì´ ëœ° ê²ƒì´ë‹¤. ìš°ë¦¬ëŠ” ì•Œë¦¼ì„ ë„ìš¸ ê²ƒì´ë¯€ë¡œ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ë©´ ëœë‹¤.

![image](https://user-images.githubusercontent.com/41438361/120768674-6018d980-c557-11eb-8405-4f25f977d2b4.png)

ì—¬ê¸°ì„œ í•œ ë²ˆ ì„ íƒí•˜ë©´ ì‹œìŠ¤í…œì€ ì´ ì‚¬ìš©ìì˜ ì„ íƒì„ ê¸°ì–µí•˜ê¸° ë•Œë¬¸ì— ë‹¤ìŒë¶€í„° ì•±ì— ëŒ€í•œ ì•Œë¦¼ì„ ë„ìš¸ ê¶Œí•œì„ ë˜ ìš”ì²­í•˜ì§€ ì•ŠëŠ”ë‹¤. ë§Œì•½ ì´ ì•Œë¦¼ì„
ë„ìš¸ ê¶Œí•œì„ ìˆ˜ì •í•˜ê±°ë‚˜ ì¬ ìš”ì²­í•˜ë ¤ë©´ ì‹œë®¬ë ˆì´í„°ì˜ ì„¤ì •ì˜ ì•Œë¦¼ì— ëŒ€í•œ ê¶Œí•œì„ ìˆ˜ì •í•˜ê±°ë‚˜ Xcodeì—ì„œ ì•±ì„ ì‚­ì œí•˜ê³  ë‹¤ì‹œ ì‹¤í–‰ì‹œí‚¨ë‹¤. ì—¬ê¸°ê¹Œì§€ ì˜ ë–´ë‹¤ë©´ ì•±ì´ ì•Œë¦¼ì„ ë„ìš¸ ê¶Œí•œì„ ì‚¬ìš©ìì—ê²Œ ìš”ì²­í•˜ëŠ” ë¶€ë¶„ì€ ì˜ ì„¤ì •ì´ ë˜ì—ˆë‹¤.

## 2. apns íŒŒì¼ ìƒì„±í•˜ê¸° 

APNsëŠ” Apple Push Notification serviceì˜ ì•½ìë¡œ, ì•± ì™¸ë¶€ì—ì„œ ë³´ë‚´ëŠ” ì•Œë¦¼ì„ ì‚¬ìš©ì ê¸°ê¸°ì— ì „ë‹¬í•˜ëŠ” ê²ƒì„ ê´€ë¦¬í•˜ëŠ” ê³³ì´ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤. ìì„¸í•œ ê°œë…ì€ [ì—¬ê¸°](https://yoojin99.github.io/app/User-Notifications/)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤
ì™¸ë¶€ì—ì„œ ê¸°ê¸°ì— push notificationì„ ë³´ë‚¼ ë•ŒëŠ” json í˜•ì‹ì˜ payloadë¥¼ ì‘ì„±í•˜ëŠ”ë°, ì—¬ê¸°ì„œë„ ê°™ì€ ì‘ì—…ì„ í•´ì¤€ë‹¤ê³  ìƒê°í•˜ë©´ ëœë‹¤.

í•˜ì—¬ê°„ simulatorì—ì„œ apns ë¼ëŠ” í™•ì¥ìë¥¼ ê°€ì§„ íŒŒì¼ì„ ìƒì„±í•œ í›„, ì´ë¥¼ Xcode simulatorì— ë“œë˜ê·¸-ë“œëí•˜ë©´ ì•Œë¦¼ì„ ë„ìš¸ ìˆ˜ ìˆë‹¤. ë¨¼ì € ì•„ë˜ì™€ ê°™ì´ í™•ì¥ìê°€ apnsì¸ íŒŒì¼ì„ ë§Œë“ ë‹¤. ì´ë¥¼ ë§Œë“œëŠ” ë°©ë²•ì€ í…ìŠ¤íŠ¸ í¸ì§‘ê¸°ë¥¼ ì—´ì–´
ì•„ë¬´ë§ì´ë‚˜ ì…ë ¥í•˜ê³  ë‚˜ì„œ ì €ì¥ í›„, íŒŒì¼ ì•„ì´ì½˜ì—ì„œ ìš°í´ë¦­ > ì •ë³´ ë” ê°€ì ¸ì˜¤ê¸° > ì´ë¦„ ë° í™•ì¥ì ë¶€ë¶„ì—ì„œ `~~.apns`ë¡œ ìˆ˜ì •í•œë‹¤. íŒŒì¼ ì´ë¦„ì€ ìƒê´€ ì—†ê³ , í™•ì¥ìê°€ apnsì´ê¸°ë§Œ í•˜ë©´ ëœë‹¤.

![image](https://user-images.githubusercontent.com/41438361/120769685-5479e280-c558-11eb-9920-aa10e47b15da.png)

ê·¸ë¦¬ê³  ë‚˜ì„œ íŒŒì¼ì„ ì—° ë‹¤ìŒ, ë‚´ìš©ì„ ì•„ë˜ì™€ ê°™ì´ json í˜•ì‹ì˜ í…ìŠ¤íŠ¸ë¡œ ìˆ˜ì •í•œë‹¤.

```json
{
  "aps": {
    "alert": {
      "title": "Push í…ŒìŠ¤íŠ¸",
      "body": "ğŸ¥³ Woohoo! Push notification in simulator! ğŸ‰",
      "sound": "default"
    },
    "badge": 10
  },
  "Simulator Target Bundle": "ì—¬ê¸°ì— ìì‹  ì•±ì˜ Bundle Identifierë¥¼ ë„£ëŠ”ë‹¤." 
}
```

ìœ„ì—ë„ ì ì–´ë†¨ì§€ë§Œ Simulator Target Bundle ë¶€ë¶„ì—ëŠ” ìì‹  ì•±ì˜ Bundle Identifierë¥¼ ë„£ì–´ì¤˜ì•¼ í•œë‹¤. ë‚´ ì•±ì˜ Bundle IdentifierëŠ” Xcodeì˜ í”„ë¡œì íŠ¸ ì„¤ì • > General > Identityì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
ì•„ë˜ì˜ íŒŒë€ìƒ‰ìœ¼ë¡œ í•˜ì´ë¼ì´íŠ¸ ëœ ë¶€ë¶„ì´ ë‚´ ì•±ì˜ Bundle Identifierë‹¤. 

![image](https://user-images.githubusercontent.com/41438361/120770299-f4d00700-c558-11eb-81ae-1085fe0562e6.png)

ë‹¤ ì…ë ¥í–ˆìœ¼ë©´ ì €ì¥ì„ ëˆŒëŸ¬ íŒŒì¼ì„ ì €ì¥í•œë‹¤. êµ³ì´ ì´ë ‡ê²Œ apns íŒŒì¼ì„ ë§Œë“œëŠ” ì´ìœ ëŠ” í…ìŠ¤íŠ¸ í¸ì§‘ê¸°ì—ì„œ ë°”ë¡œ ìœ„ì˜ Json í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê³  ì €ì¥ í›„ í™•ì¥ìë¥¼ apnsë¡œ ë°”ê¾¸ë©´ ì•„ë˜ì™€ ê°™ì´ ê¸°ê´´í•˜ê²Œ íŒŒì¼ì˜ ë‚´ìš©ì´ ë°”ë€Œê¸° ë•Œë¬¸ì´ë‹¤.

![image](https://user-images.githubusercontent.com/41438361/120770668-5b552500-c559-11eb-9190-2b49c186fabb.png)

ì •ìƒì ìœ¼ë¡œ apns íŒŒì¼ì´ ë§Œë“¤ì–´ì¡Œë‹¤ë©´ íŒŒì¼ì„ ì—´ì—ˆì„ ë•Œ ì•„ë˜ì™€ ê°™ì´ ë‚˜ì™€ì•¼ í•œë‹¤.

![image](https://user-images.githubusercontent.com/41438361/120770852-8e97b400-c559-11eb-859a-bf683c32ae7f.png)

ì´ì œ ì‹œë®¬ë ˆì´í„°ë¥¼ ì‹¤í–‰ì‹œí‚¤ê³ , <kbd>command</kbd> + <kbd>shift</kbd> + <kbd>h</kbd>ë¥¼ ëˆ„ë¥´ê±°ë‚˜ ì‹œë®¬ë ˆì´í„° ìƒë‹¨ì˜ í™ˆ í™”ë©´ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì•±ì„ backgroundë¡œ ë³´ë‚´ì¤€ë‹¤. ê·¸ë¦¬ê³  ë°©ê¸ˆ ìƒì„±í•œ apns íŒŒì¼ì„ 
ì‹œë®¬ë ˆì´í„°ì˜ í™”ë©´ìœ¼ë¡œ ë“œë˜ê·¸-ë“œë¡­í•œë‹¤. ê·¸ëŸ¼ ì•„ë˜ì™€ ê°™ì´ Push ì•Œë¦¼ì´ ì˜ ëœ¨ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤!ğŸ¥³

![image](https://user-images.githubusercontent.com/41438361/120771453-2eedd880-c55a-11eb-9705-bb10592aac5f.png)

ì—¬ê¸°ê¹Œì§€ë§Œ í•˜ë©´ ì•±ì´ background, ì¦‰ í™”ë©´ì—ì„œ êº¼ì¡Œì„ ë•Œ ì•Œë¦¼ì„ ë„ìš°ëŠ” ê²ƒì„ í•´ë³¸ ê²ƒì´ë‹¤.

ì´ì œëŠ” ì•±ì´ í™”ë©´ì— ë–  ìˆì„ë•Œ ì•Œë¦¼ì„ ë„ìš°ëŠ” ê²ƒê³¼, Push ì•Œë¦¼ì„ í„°ì¹˜í–ˆì„ ë•Œ requestë¡œ ë“¤ì–´ì˜¤ëŠ” payloadì˜ ê°’ì„ ì¶”ì¶œí•´ íŠ¹ì • ë™ì‘ì„ í•˜ê²Œ í•˜ëŠ” ê²ƒë„ êµ¬í˜„í•´ë³´ì.

## 3. UNUserNotificationCenterDelegate êµ¬í˜„í•´ì„œ ì•Œë¦¼ì— ëŒ€í•œ ë™ì‘ ì²˜ë¦¬í•˜ê¸° 

ë°”ë¡œ ìœ„ì—ì„œ ë§í•œ ì•±ì´ í™”ë©´ì— ë–  ìˆì„ ë•Œ(foreground) ì•Œë¦¼ì´ ì˜¤ë©´ push ì•Œë¦¼ì„ ë„ìš°ëŠ” ê²ƒ, ê·¸ë¦¬ê³  push ì•Œë¦¼ì„ í„°ì¹˜í–ˆì„ ë•Œ íŠ¹ì • ë™ì‘ì„ í•˜ê²Œë” í•˜ë ¤ë©´ UNUserNotificationCenterDelegateë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.

ë¨¼ì € 1ë²ˆì—ì„œ ì‘ì„±í•œ `func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool` í•¨ìˆ˜ ì•ˆì— ë‹¤ìŒê³¼ ê°™ì´ delegateë¥¼ ì„¤ì •í•˜ëŠ” ë¶€ë¶„ì„ ì¶”ê°€í•´ì¤€ë‹¤.

```swift
func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
    // Override point for customization after application launch.
    let center = UNUserNotificationCenter.current()
    center.delegate = self // ì—¬ê¸° ì¶”ê°€
    center.requestAuthorization(options: [.alert, .sound, .badge]) { granted, error in
        print("Permission granted : \(granted)")
    }

    UIApplication.shared.registerForRemoteNotifications()
    return true
}
```

ê·¸ë¦¬ê³  AppDelegateê°€ UNUserNotificationCenterDelegate í”„ë¡œí† ì½œì„ ë”°ë¥´ë„ë¡ êµ¬í˜„í•œë‹¤. ë‚˜ëŠ” extensionìœ¼ë¡œ êµ¬í˜„í–ˆë‹¤.

```swift
extension AppDelegate: UNUserNotificationCenterDelegate {
    func userNotificationCenter(_ center: UNUserNotificationCenter, willPresent notification: UNNotification, withCompletionHandler completionHandler: @escaping (UNNotificationPresentationOptions) -> Void) {
        // ì•±ì´ foregroundì— ìˆì„ ë•Œ push ì•Œë¦¼ì´ ì˜¤ë©´ ì´ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤.
    }
    
    func userNotificationCenter(_ center: UNUserNotificationCenter, didReceive response: UNNotificationResponse, withCompletionHandler completionHandler: @escaping () -> Void) {
        // ì‚¬ìš©ìê°€ push ì•Œë¦¼ì„ í„°ì¹˜í•˜ë©´ ì´ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤.
    }
}
```

### ì•±ì´ foregroundì— ìˆì„ ë•Œ push ì•Œë¦¼ ëœ¨ê²Œ í•˜ê¸°

ìœ„ì˜ ì½”ë“œì˜ ì²« ë²ˆì§¸ ë©”ì„œë“œë¥¼ ì•„ë˜ì™€ ê°™ì´ êµ¬í˜„í•œë‹¤.

```swift
func userNotificationCenter(_ center: UNUserNotificationCenter, willPresent notification: UNNotification, withCompletionHandler completionHandler: @escaping (UNNotificationPresentationOptions) -> Void) {
    // ì•±ì´ foregorundì¼ ë•Œ í‘¸ì‹œê°€ ì˜¤ë©´ banner, badge, soundí‘œì‹œë¥¼ í•˜ë¼ëŠ” ì˜ë¯¸. ì°¸ê³ ë¡œ .alertì€ ios 14ì—ì„œ deprecated ë˜ì—ˆë‹¤.
    completionHandler([.banner, .badge, .sound])
}
```

ê·¸ë¦¬ê³  ì‹œë®¬ë ˆì´í„°ë¥¼ ì‹¤í–‰ì‹œí‚¤ê³ , ì•±ì´ í™”ë©´ì— ë–  ìˆëŠ” ìƒíƒœì—ì„œ ìœ„ì—ì„œ ë§Œë“  apns íŒŒì¼ì„ ì‹œë®¬ë ˆì´í„°ì˜ í™”ë©´ìœ¼ë¡œ ë“œë˜ê·¸-ë“œë¡­ í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ push ì•Œë¦¼ì´ ëœ¨ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/41438361/120772905-c0aa1580-c55b-11eb-81b9-0bfe83808135.png)

### ì•±ì˜ push ì•Œë¦¼ì„ í„°ì¹˜í–ˆì„ ë•Œ íŠ¹ì • ë™ì‘ ì²˜ë¦¬í•˜ê¸°

ë‘ ë²ˆì§¸ ë©”ì„œë“œë¥¼ êµ¬í˜„í•  ë•Œ í•˜ê³  ì‹¶ì€ ë™ì‘ì„ í•˜ë„ë¡ êµ¬í˜„í•˜ë©´ ëœë‹¤. apns íŒŒì¼ì— ì‘ì„±í–ˆë˜ jsonì˜ í˜•ì‹ì„ ì¢€ ë” ë‹¤ë¥´ê²Œ í•´ì„œ requestë¥¼ ë³´ë‚´ê³ , ì´ë¥¼ ì•±ì—ì„œ ë°›ì•„ì„œ ì²˜ë¦¬í•  ìˆ˜ë„ ìˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ ë‚´ê°€ apns íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í–ˆë‹¤ê³  í•´ë³´ì.

```json
{
  "aps": {
    "alert": {
      "title": "Push í…ŒìŠ¤íŠ¸",
      "body": "ğŸ¥³ Woohoo! Push notification in simulator! ğŸ‰",
      "sound": "default"
    },
    "badge": 10
  },
  "Simulator Target Bundle": "ë‚´ ì•±ì˜ Bundle Identifier",
  "url" : "textì¸ë°ìš”~" 
}
```

ì„ì˜ë¡œ urlì´ë¼ëŠ” í•„ë“œë¥¼ ì¶”ê°€í–ˆë‹¤. ì–´ë–¤ ê°’ì„ ì¶”ê°€í•  ì§€ëŠ” ë§ˆìŒëŒ€ë¡œ ì„¤ì •í•´ë„ ëœë‹¤. ê·¸ë¦¬ê³  ë©”ì„œë“œë¥¼ ì•„ë˜ì™€ ê°™ì´ êµ¬í˜„í•˜ê³  ì‹œë®¬ë ˆì´í„°ì—ì„œ push ì•Œë¦¼ì´ ë–´ì„ ë•Œ push ì•Œë¦¼ì„ í´ë¦­í•˜ë©´ Xcodeì˜ ì½˜ì†”ì— `Optional("textì¸ë°ìš”~")`ë¼ê³  ëœ¨ê²Œ ëœë‹¤.

```swift
func userNotificationCenter(_ center: UNUserNotificationCenter, didReceive response: UNNotificationResponse, withCompletionHandler completionHandler: @escaping () -> Void) {
    // ì‚¬ìš©ìì˜ push ì•Œë¦¼ì— ëŒ€í•œ response ì²˜ë¦¬
    let url = response.notification.request.content.userInfo["url"] // ì—¬ê¸°ì—ì„œ ë‚´ê°€ ì›í•˜ëŠ” í‚¤ ê°’ìœ¼ë¡œ ê°’ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë‹¤.
    print(url)
}
```

ì´ë ‡ê²Œ jsonì˜ Payloadì— ì›í•˜ëŠ” ê°’ì„ ë§˜ëŒ€ë¡œ êµ¬ì„±í•´ì„œ ì´ì— ë”°ë¼ ì•±ì—ì„œ pushë¥¼ í´ë¦­í–ˆì„ ë•Œ ì•±ì´ ë‹¤ë¥´ê²Œ ë™ì‘í•˜ë„ë¡ êµ¬í˜„í•  ìˆ˜ë„ ìˆë‹¤.

