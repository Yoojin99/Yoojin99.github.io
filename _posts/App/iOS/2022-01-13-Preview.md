---  
layout: post  
title: "[iOS] - Preview UIViewController in Xcode"  
subtitle: ""  
categories: app
tags: app-ios Xcode preview 
comments: true  
header-img: 

---  
  
> `Xcode에서 UIViewController를 preview를 통해 미리 확인할 수 있을까?`  

---

![image](https://user-images.githubusercontent.com/41438361/149276497-c3d2dda6-686c-4d8a-8a39-e90fce611502.png)

위 이미지는 Xcode를 구글에서 검색한 결과로, 굉장히 멋있다. 왼쪽에서는 코딩을 하고, 오른쪽에서는 내가 코딩을 하는대로 그 결과가 화면에서 실제로 어떻게 보여지는 지를 확인할 수 있는데,
정말 정말 편리한 기능일 것이라고 생각하는데, 정작 나는 저 기능을 지금까지 개발하며 써본 적이 없었다. 

![image](https://user-images.githubusercontent.com/41438361/149277144-3535729e-b10c-4355-aa7c-3473f63d679a.png)

나는 이런 코드만 계속 작성하다가 한 번 화면에 어떻게 나오는 지를 확인하고 싶으면 Run 해서 시뮬레이터에서 확인하고, 수정 사항이 생기면 다시 코드를 수정하고,
다시 빌드-실행 하고... 이 무한의 굴레를 반복했다. 물론 처음 한 번 빌드하고 나서 수정 후 다시 빌드하고 실행하는 시간이 그렇게 오래 걸리는 것은 아니다. 하지만
굳이 수정사항을 확인하기 위해 빌드하고 실행하고 다시 수정하고 빌드하고 실행하고 이런 사이클을 돌 필요는 없다고 생각한다.

Xcode를 소개하는 이미지를 찾다보면 저런 2분할 화면(코드-시뮬레이터)을 쉽게 볼 수 있는데, 이는 그만큼 이 기능이 굉장히 Xcode의 핵심 기능임을 나타내는 것이 아닐까?
실제로 주 기능이 아니더라도 분명 개발하는 데 도움을 주는 것은 맞는 것으로 보인다. 그래서 이 멋진 기능을 사용하는 방법을 알아볼 것이다.

# Preview

위와 같이 내가 만든 뷰를 미리 보여주는 걸 **Preview**라고 한다. 이 Preview라는 기능을 통해 내가 만든 뷰의 동적이고, 상호작용 가능한 프리뷰들을 만들 수 있다.

[Previews in Xcode](https://developer.apple.com/documentation/swiftui/previews-in-xcode)라는 공식 문서를 보면, 이 기능은 Swift Framework에서 사용할 수 있다.
그렇다고 UIKit의 UIViewController, UIView를 Preview로 띄우지 못하는 것은 아니다. UIViewController와 UIView를 Preview로 띄우는 것은 좀 뒤에 해보겠다.

SwiftUI로 내가 임의로 View를 만들면, Xcode가 내가 이 view의 코드를 수정할 때마다 바뀌는 뷰의 컨텐츠의 preview를 보여준다. 이 Preview를 이용하려면
Xcode에게 띄워달라고 할 구조체를 정의해야 하는데, 이 구조체는 `PreviewProvider` 프로토콜을 채택해야 한다. 그러면 코드 옆의 canvas에 아래와 같이 preview를 보여준다.

![image](https://user-images.githubusercontent.com/41438361/149278440-0ec16d94-c1bb-42e9-9a48-a54980176ee7.png)

간단히 설명하면 위 화면의 오른쪽에 프리뷰가 뜬 곳이 canvas다. 이 캔버스에 대해 자세히 설명된 [좋은 글](https://zeddios.tistory.com/869)이 있으니 
시간이 있으면 읽어보는 것이 좋을 것 같다. 이 캔버스에서 지원하고 있는 기능 중 하나가 Preview인 것이다.

다시 preview로 돌아와서, preview를 구성하기 위해 `previewDevice(_:)`나 `previewInterfaceOrientation(_:)`과 같은 preview-specific modifier를 포함해서
view modifier를 사용할 수 있다. 

위에서 view의 코드를 내가 수정하면 이 수정사항이 반영된 view의 content를 프리뷰로 보여준다고 했는데, 더 놀라운 건 canvas에 만든 수정사항도 code로 반영시켜준다는 것이다. 정말 멋진 기능이다.

## PreviewProvider protocol

위에서 preview를 이용하려면 Xcode에게 띄워달라고 할 구조체를 정의해야 하는데, `PreviewProvider`를 따르게 해야 한다고 했다. 그러면 이 
`PreviewProvider` 프로토콜도 무엇인지 보자.

PreviewProvider 프로토콜은 Xcode에서 view의 프리뷰를 생성하는 타입이다. iOS 13부터 사용 가능하다. iPadOS는 13.0, watchOS는 6.0 부터 사용가능하다.

사용하는 방법은, `PreviewProvider` 프로토콜을 채택하는 구조체를 선언해서 Xcode preview를 만드는 것이다. 요구되는 `previews` 연산 프로퍼티를 구현하고, 보여줄 view를 리턴한다.

```swift
struct CircleImage_Previews: PreviewProvider {
    // View 리턴, CircleImage 인스턴스를 리턴하고 있다.
    static var previews: some View {
        CircleImage()
    }
}
```

그런데 `CircleImage_Previews` 처럼 `PreviewProvider`를 따르는 구조체를 그냥 정의해두면 Xcode가 알 수 있을까? Xcode는 내 프로젝트 안에 있는
preview provider를 찾고, 현재 소스 에디터에 띄워져 있는 provider들의 preview를 생성한다. 

프리뷰가 어떻게 나타나는지를 바꾸려면위에서 View를 생성할 때 했던 것처럼 view modifier를 추가하면 된다. 이를 통해 디바이스 가로-세로 방향등을 바꿀 수 있다.

```swift
struct CircleImage_Previews: PreviewProvider {
    static var previews: some View {
        CircleImage()
            .previewInterfaceOrientation(.landscapeLeft)
    }
}
```

![image](https://user-images.githubusercontent.com/41438361/149280480-7ff581bd-39dc-4fa0-8930-9ba19103003d.png)

이렇게 프리뷰를 커스터마이징 하는 것에 대해 더 보려면 [Previews in Xcode](https://developer.apple.com/documentation/swiftui/previews-in-xcode)를 참고하면 된다.

Xcode는 preview안에 내가 만든 각각의 뷰마다 다른 preview를 생성해주기 때문에, 뷰의 다양한 버전들을 프리뷰로 한 번에 확인할 수 있다. 예를 들어 밝은 view와 
어두운 view를 동시에 확인하고 싶다면 아래와 같이 설정하면 된다.

```swift
struct CircleImage_Previews: PreviewProvider {
    static var previews: some View {
        CircleImage()
        CircleImage()
            .preferredColorScheme(.dark)
    }
}
```

다양한 뷰를 동시에 보고 싶은데, 하나의 modifier를 모두에게 적용하려면 `Group`을 사용하면 된다.

```swift
struct CircleImage_Previews: PreviewProvider {
    static var previews: some View {
        Group {
            CircleImage()
            CircleImage()
                .preferredColorScheme(.dark)
        }
        .previewLayout(.sizeThatFits) // 밝은 CircleImage와 어두운 CircleImage에 sizeThatFit를 적용했다.
    }
}
```

![image](https://user-images.githubusercontent.com/41438361/149281465-81dced1e-ace1-479a-91df-83a7ae23eec1.png)

위에서 required computed property인 `preivews` 구현해서 보여줄 view를 리턴한다고 했다. 이 프로토콜에서 설정할 수 있는(구현할 수 있는) 
property는 `previews`와 `platform`이 있다.

![image](https://user-images.githubusercontent.com/41438361/149281893-3760f96c-65bd-4f2f-955c-786f80d544bb.png)

프리뷰를 생성하기 위해 어떤 뷰를 리턴할지 정해주는 것은 `preview`를 쓰면 되고, 어떤 플랫폼에서 provider를 실행시킬지 정하는 것은 `platform`을 사용하면 된다.

보면 `previews`와 `platform`이 requried라고 되어 있는데, `platform`의 경우 멀티 플랫폼 타겟을 가지고 있지 않는 한 이 값을 무시한다고 한다.

또 associatedtype인 `Previews`가 있다. 얘는 따로 provider 내에서 지정하지 않고 preview를 생성할 때, `previews` 프로퍼티에서 구현된 것에서 이 타입을 자동으로 추론해준다.

## 사용





